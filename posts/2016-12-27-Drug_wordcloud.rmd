---
title: "Drugs' name wordcloud"
output: 
  html_document: 
    keep_md: yes
    self_contained: no
---

```{r setup, include=FALSE, warning=FALSE}
library(knitr)
opts_chunk$set(echo = TRUE, warning= FALSE)
opts_knit$set(root.dir = "../.")

library(dplyr)
```

I followed my good resolutions on practising data analysis in [my previous post](http://blog.jom.link/data_science_pet_project.html) and started to play with the [French drug database](https://github.com/jomuller/explore_drug_database).

After importing the data, I started classically with data visualisation. In this database, there is a lot of text data. To visualise this, some wordcloud is always welcome. They are maybe not accurate at all but are from my point of view a very good illustration of a text-based dataset.

To my knowledge there are two main wordcloud packages in R :

- [*wordcloud*](https://cran.rstudio.com/web/packages/wordcloud/index.html): produce plot
- [*wordcloud2*](https://cran.rstudio.com/web/packages/wordcloud2/index.html): produce html widget

Let's play with this.

# Prepare the data

```{r}
# Read the previously imported data
db <- readRDS("raw_rds/bdpm.rds")
```

For example, there is the **pharmaceutical form** column.

```{r}
head(db$forme)
```

There is a lot of different forms

```{r}
uforme <- unique(db$forme)
length(uforme)
```

405 various form. But there is multiple form in one line sometimes, separated by "et". Try to find the real different form.

```{r}
forms <- db$forme %>%
  strsplit(split = " et ") %>%
  unlist() 
  
length(unique(forms))  
head(forms)

```

Select the 100 most frequent

```{r}
head(as.data.frame(table(forms)))
cent <- forms %>%
  table() %>%
  as.data.frame() %>%
  arrange(desc(Freq)) %>%
  head(100)

kable(head(cent))
```

# Wordcloud

Make a wordcloud with *wordcloud*

```{r, warning=F, message = F}
library(wordcloud)
wordcloud(cent$., freq = cent$Freq)
```

Not bad. Try something funkier.

```{r, warning=F}
wordcloud(
  words = cent$., 
  freq = cent$Freq, 
  random.color = T, 
  random.order = F, 
  colors = brewer.pal(8,"Dark2")
)
```

I find this very informative. Intituively it's possible to see what's the most frequent forms are. And is far more attractive than a table or an unreadable barplot.

```{r}
library(ggplot2)

ggplot(cent) +
  aes(x = ., y = Freq) +
  geom_bar(stat = "identity") +
  coord_flip()
  
```

OK, I would be possible to make a better plot but I think you see the point.

# Wordcloud 2

Wordcloud 2 produce html widget

```{r}
library(wordcloud2)
wordcloud2(cent)
```

It's easier and more fun! Try it, it's interactive.

Enough with wordcloud. We understood that's the "comprimé" (tablet) pharmaceutical form is the most frequent, followed by the "gélule" (capsule), "poudre" (powder) and "granule" (small pill). We can also see that's some text cleaning would be necessary to make a proper analysis.

